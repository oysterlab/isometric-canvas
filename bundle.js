(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
'use strict';

Object.defineProperty(exports, "__esModule", {
    value: true
});

var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

var FFT = function () {
    function FFT() {
        _classCallCheck(this, FFT);

        this.audio = new Audio();
        this.context = new AudioContext();
        this.frequencyData = [];
    }

    _createClass(FFT, [{
        key: 'load',
        value: function load(audioFile) {
            var _this = this;

            var FFT_SIZE = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 1024;

            var this_ = this;
            return new Promise(function (resolve) {
                var audio = _this.audio,
                    context = _this.context;

                audio.src = audioFile;
                var analyser = context.createAnalyser();
                var source = context.createMediaElementSource(audio);

                source.connect(analyser);
                analyser.connect(context.destination);
                analyser.fftSize = FFT_SIZE * 2;

                audio.removeEventListener('ended', this_.start);
                audio.addEventListener('ended', this_.start);
                this_.start();

                audio.onloadeddata = function () {
                    this_.analyser = analyser;
                    this_.frequencyData = new Uint8Array(analyser.frequencyBinCount);
                    resolve();
                };
            });
        }
    }, {
        key: 'getFrequency',
        value: function getFrequency() {
            var analyser = this.analyser,
                frequencyData = this.frequencyData;

            if (analyser) analyser.getByteFrequencyData(frequencyData);
            return frequencyData;
        }
    }, {
        key: 'start',
        value: function start() {
            var audio = this.audio;

            audio.currentTime = 0;
            audio.play();
        }
    }]);

    return FFT;
}();

exports.default = FFT;

},{}],2:[function(require,module,exports){
'use strict';

var _FFT = require('./FFT');

var _FFT2 = _interopRequireDefault(_FFT);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

document.body.style.padding = '0px';
document.body.style.maring = '0px';

var fft = new _FFT2.default();
fft.load('./resources/Ezun+-+Revager+(Original+Mix)+-+Master.mp3', 128).then(function () {});

var WIDTH = window.innerWidth;
var HEIGHT = window.innerHeight;
var canvas = document.createElement('canvas');
canvas.width = WIDTH;
canvas.height = HEIGHT;
document.body.appendChild(canvas);

var context = canvas.getContext('2d');

var DIGONAL_SIZE = 16; // must be odd number

var w = WIDTH > HEIGHT ? HEIGHT / parseInt(DIGONAL_SIZE * 1.8) : WIDTH / parseInt(DIGONAL_SIZE * 1.8);
var h = WIDTH > HEIGHT ? HEIGHT / parseInt(DIGONAL_SIZE * 1.8) : WIDTH / parseInt(DIGONAL_SIZE * 1.8);
var BLOCK_MAX_HEIGHT = h * 2;
var p1 = [0. * w, -0.5 * h];
var p2 = [1. * w, 0. * h];
var p3 = [0. * w, 0.5 * h];
var p4 = [-1. * w, 0. * h];

var blocks = [];
var countMap = {};
for (var r = 0; r <= DIGONAL_SIZE; r++) {
  var t = Math.sin(r / DIGONAL_SIZE * Math.PI).toFixed(2);
  var colCount = countMap[t];

  if (!colCount) {
    var countArr = Object.keys(countMap).map(function (key) {
      return countMap[key];
    });
    countMap[t] = countArr.length == 0 ? 1 : Math.max.apply(null, countArr) + 1;
    colCount = countMap[t];
  }

  var sc = w * 0.5 - colCount * w;
  for (var c = 0; c < colCount; c++) {
    blocks.push({
      x: sc + c * w * 2, y: r * h * 0.5
    });
  }
}

var prevAvg = 0;
var render = function render(t) {
  var frequency = fft.getFrequency();

  context.clearRect(0, 0, WIDTH, HEIGHT);
  context.fillStyle = '#000';
  context.fillRect(0, 0, WIDTH, HEIGHT);

  var clusterPositions = [{
    x: WIDTH * 0.5 + w * 0.5, y: HEIGHT * 0.5 - h * 3.
  }];

  clusterPositions.forEach(function (cp, j) {

    context.save();
    context.translate(cp.x, cp.y);

    var sum = 0;
    blocks.forEach(function (_ref, i) {
      var x = _ref.x,
          y = _ref.y;

      var r = 140 + prevAvg * 20 - i * 0.3; //parseInt(Math.random() * 255)
      var g = 60 - prevAvg * 40 - i * 0.3; //parseInt(Math.random() * 255)
      var b = 60 - prevAvg * 40 - i * 0.3; //parseInt(Math.random() * 255)

      var f = Math.abs(Math.sin(0.8 * Math.PI * i / blocks.length + t * 0.004)) * 0.001;
      if (frequency.length > 0) {
        f += frequency[i + 20] / 128;
        sum += frequency[i + 20] / 128;
      }
      var h = -(BLOCK_MAX_HEIGHT * 0.1) - BLOCK_MAX_HEIGHT * 0.9 * Math.pow(f + 0.5, 2) * 0.5;

      var m = 0; //parseInt(-(1. - r) * 20)

      context.beginPath();
      context.moveTo(x + p1[0], y + p1[1] + h);
      context.lineTo(x + p2[0], y + p2[1] + h);
      context.lineTo(x + p3[0], y + p3[1] + h);
      context.lineTo(x + p4[0], y + p4[1] + h);
      context.closePath();
      context.fillStyle = 'rgb(' + (r + m) + ', ' + (g + m) + ', ' + (b + m) + ')';
      context.fill();

      context.beginPath();
      context.moveTo(x + p3[0], y + p3[1] + h);
      context.lineTo(x + p4[0], y + p4[1] + h);
      context.lineTo(x + p4[0], y + p4[1]);
      context.lineTo(x + p3[0], y + p3[1]);
      context.closePath();
      context.fillStyle = 'rgb(' + (r - 10 + m) + ', ' + (g - 10 + m) + ', ' + (b - 10 + m) + ')';
      context.fill();

      context.beginPath();
      context.moveTo(x + p2[0], y + p2[1] + h);
      context.lineTo(x + p2[0], y + p2[1]);
      context.lineTo(x + p3[0], y + p3[1]);
      context.lineTo(x + p3[0], y + p3[1] + h);
      context.closePath();
      context.fillStyle = 'rgb(' + (r + 10 + m) + ', ' + (g + 10 + m) + ', ' + (b + 10 + m) + ')';
      context.fill();
    });
    prevAvg = sum / blocks.length;
    context.restore();
  });

  requestAnimationFrame(render);
};

requestAnimationFrame(render);

},{"./FFT":1}]},{},[2])
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJzcmMvRkZULmpzIiwic3JjL2luZGV4LmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBOzs7Ozs7Ozs7OztJQ0NBLEFBQU0sQUFBSSxBQUNOOztBQUFjLEFBQ1Y7O2FBQUEsQUFBSyxRQUFRLElBQWIsQUFBYSxBQUFJLEFBQ2pCO2FBQUEsQUFBSyxVQUFVLElBQWYsQUFBZSxBQUFJLEFBQ25CO2FBQUEsQUFBSyxnQkFBTCxBQUFxQixBQUN4QjtBQUVEOzs7OzZCQUFBLEFBQUs7QUFBNEIsQUFDN0I7O2dCQURZLCtFQUFoQixBQUEyQjs7Z0JBQ2pCLFFBQU4sQUFBYyxBQUNkO3VCQUFPLEFBQUksUUFBUSxBQUFDO0FBQVksQUFDNUIsQUFBTSxvQkFBQSxBQUFFO29CQUFSLEFBQU0sQUFBUyxBQUFZLEFBQzNCOztzQkFBQSxBQUFNLE1BQU4sQUFBWSxBQUNaO29CQUFNLFdBQVcsUUFBakIsQUFBaUIsQUFBUSxBQUN6QjtvQkFBTSxTQUFTLFFBQUEsQUFBUSx5QkFBdkIsQUFBZSxBQUFpQyxBQUVoRDs7dUJBQUEsQUFBTyxRQUFQLEFBQWUsQUFDZjt5QkFBQSxBQUFTLFFBQVEsUUFBakIsQUFBeUIsQUFDekI7eUJBQUEsQUFBUyxVQUFVLFdBQW5CLEFBQThCLEFBRTlCOztzQkFBQSxBQUFNLG9CQUFOLEFBQTBCLFNBQVMsTUFBbkMsQUFBeUMsQUFDekM7c0JBQUEsQUFBTSxpQkFBTixBQUF1QixTQUFTLE1BQWhDLEFBQXNDLEFBQ3RDO3NCQUFBLEFBQU0sQUFFTjs7c0JBQUEsQUFBTSxlQUFlLFlBQU0sQUFDdkI7MEJBQUEsQUFBTSxXQUFOLEFBQWlCLEFBQ2pCOzBCQUFBLEFBQU0sZ0JBQWdCLElBQUEsQUFBSSxXQUFXLFNBQXJDLEFBQXNCLEFBQXdCLEFBQzlDO0FBQ0g7QUFKRCxBQU1IO0FBcEJELEFBQU8sQUFxQlYsYUFyQlU7QUF1Qlg7Ozs7QUFBZSxBQUNYLEFBQU0sZ0JB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SUFBSSxJQUFJLEdBQTlCLEFBQThCLEFBQUcsQUFDakM7Y0FBQSxBQUFRLE9BQU8sSUFBSSxHQUFuQixBQUFtQixBQUFHLElBQUksSUFBSSxHQUE5QixBQUE4QixBQUFHLEFBQ2pDO2NBQUEsQUFBUSxBQUNSO2NBQUEsQUFBUSxBQUFhLHNCQUFNLElBQUEsQUFBSSxLQUFLLEFBQUUsYUFBSSxJQUFBLEFBQUksS0FBSyxBQUFFLGFBQUksSUFBQSxBQUFJLEtBQTdELEFBQWtFLEFBQUUsQUFDcEU7Y0FBQSxBQUFRLEFBRVI7O2NBQUEsQUFBUSxBQUNSO2NBQUEsQUFBUSxPQUFPLElBQUksR0FBbkIsQUFBbUIsQUFBRyxJQUFJLElBQUksR0FBSixBQUFJLEFBQUcsS0FBakMsQUFBc0MsQUFDdEM7Y0FBQSxBQUFRLE9BQU8sSUFBSSxHQUFuQixBQUFtQixBQUFHLElBQUksSUFBSSxHQUE5QixBQUE4QixBQUFHLEFBQ2pDO2NBQUEsQUFBUSxPQUFPLElBQUksR0FBbkIsQUFBbUIsQUFBRyxJQUFJLElBQUksR0FBOUIsQUFBOEIsQUFBRyxBQUNqQztjQUFBLEFBQVEsT0FBTyxJQUFJLEdBQW5CLEFBQW1CLEFBQUcsSUFBSSxJQUFJLEdBQUosQUFBSSxBQUFHLEtBQWpDLEFBQXNDLEFBQ3RDO2NBQUEsQUFBUSxBQUNSO2NBQUEsQUFBUSxBQUFhLHNCQUFNLElBQUEsQUFBSSxLQUFLLEFBQUUsYUFBSSxJQUFBLEFBQUksS0FBSyxBQUFFLGFBQUksSUFBQSxBQUFJLEtBQTdELEFBQWtFLEFBQUUsQUFDcEU7Y0FBQSxBQUFRLEFBQ1Q7QUF4Q0QsQUF5Q0E7Y0FBVSxNQUFNLE9BQWhCLEFBQXVCLEFBQ3ZCO1lBQUEsQUFBUSxBQUNUO0FBakRELEFBbURBOzt3QkFBQSxBQUFzQixBQUN2QjtBQWpFRDs7QUFtRUEsc0JBQUEsQUFBc0IiLCJmaWxlIjoiZ2VuZXJhdGVkLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbiBlKHQsbixyKXtmdW5jdGlvbiBzKG8sdSl7aWYoIW5bb10pe2lmKCF0W29dKXt2YXIgYT10eXBlb2YgcmVxdWlyZT09XCJmdW5jdGlvblwiJiZyZXF1aXJlO2lmKCF1JiZhKXJldHVybiBhKG8sITApO2lmKGkpcmV0dXJuIGkobywhMCk7dmFyIGY9bmV3IEVycm9yKFwiQ2Fubm90IGZpbmQgbW9kdWxlICdcIitvK1wiJ1wiKTt0aHJvdyBmLmNvZGU9XCJNT0RVTEVfTk9UX0ZPVU5EXCIsZn12YXIgbD1uW29dPXtleHBvcnRzOnt9fTt0W29dWzBdLmNhbGwobC5leHBvcnRzLGZ1bmN0aW9uKGUpe3ZhciBuPXRbb11bMV1bZV07cmV0dXJuIHMobj9uOmUpfSxsLGwuZXhwb3J0cyxlLHQsbixyKX1yZXR1cm4gbltvXS5leHBvcnRzfXZhciBpPXR5cGVvZiByZXF1aXJlPT1cImZ1bmN0aW9uXCImJnJlcXVpcmU7Zm9yKHZhciBvPTA7bzxyLmxlbmd0aDtvKyspcyhyW29dKTtyZXR1cm4gc30pIiwiXG5jbGFzcyBGRlQge1xuICAgIGNvbnN0cnVjdG9yKCkge1xuICAgICAgICB0aGlzLmF1ZGlvID0gbmV3IEF1ZGlvKClcbiAgICAgICAgdGhpcy5jb250ZXh0ID0gbmV3IEF1ZGlvQ29udGV4dCgpXG4gICAgICAgIHRoaXMuZnJlcXVlbmN5RGF0YSA9IFtdXG4gICAgfVxuXG4gICAgbG9hZChhdWRpb0ZpbGUsIEZGVF9TSVpFID0gMTAyNCkge1xuICAgICAgICBjb25zdCB0aGlzXyA9IHRoaXNcbiAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiB7XG4gICAgICAgICAgICBjb25zdCB7IGF1ZGlvLCBjb250ZXh0IH0gPSB0aGlzXG4gICAgICAgICAgICBhdWRpby5zcmMgPSBhdWRpb0ZpbGVcbiAgICAgICAgICAgIGNvbnN0IGFuYWx5c2VyID0gY29udGV4dC5jcmVhdGVBbmFseXNlcigpXG4gICAgICAgICAgICBjb25zdCBzb3VyY2UgPSBjb250ZXh0LmNyZWF0ZU1lZGlhRWxlbWVudFNvdXJjZShhdWRpbylcblxuICAgICAgICAgICAgc291cmNlLmNvbm5lY3QoYW5hbHlzZXIpXG4gICAgICAgICAgICBhbmFseXNlci5jb25uZWN0KGNvbnRleHQuZGVzdGluYXRpb24pXG4gICAgICAgICAgICBhbmFseXNlci5mZnRTaXplID0gRkZUX1NJWkUgKiAyXG5cbiAgICAgICAgICAgIGF1ZGlvLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2VuZGVkJywgdGhpc18uc3RhcnQpXG4gICAgICAgICAgICBhdWRpby5hZGRFdmVudExpc3RlbmVyKCdlbmRlZCcsIHRoaXNfLnN0YXJ0KVxuICAgICAgICAgICAgdGhpc18uc3RhcnQoKVxuXG4gICAgICAgICAgICBhdWRpby5vbmxvYWRlZGRhdGEgPSAoKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpc18uYW5hbHlzZXIgPSBhbmFseXNlclxuICAgICAgICAgICAgICAgIHRoaXNfLmZyZXF1ZW5jeURhdGEgPSBuZXcgVWludDhBcnJheShhbmFseXNlci5mcmVxdWVuY3lCaW5Db3VudClcbiAgICAgICAgICAgICAgICByZXNvbHZlKClcbiAgICAgICAgICAgIH1cblxuICAgICAgICB9KVxuICAgIH1cblxuICAgIGdldEZyZXF1ZW5jeSgpIHtcbiAgICAgICAgY29uc3QgeyBhbmFseXNlciwgZnJlcXVlbmN5RGF0YSB9ID0gdGhpc1xuICAgICAgICBpZiAoYW5hbHlzZXIpXG4gICAgICAgICAgICBhbmFseXNlci5nZXRCeXRlRnJlcXVlbmN5RGF0YShmcmVxdWVuY3lEYXRhKVxuICAgICAgICByZXR1cm4gZnJlcXVlbmN5RGF0YVxuICAgIH1cblxuICAgIHN0YXJ0KCkge1xuICAgICAgICBjb25zdCB7IGF1ZGlvIH0gPSB0aGlzXG4gICAgICAgIGF1ZGlvLmN1cnJlbnRUaW1lID0gMFxuICAgICAgICBhdWRpby5wbGF5KClcbiAgICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IEZGVCIsImRvY3VtZW50LmJvZHkuc3R5bGUucGFkZGluZyA9ICcwcHgnXG5kb2N1bWVudC5ib2R5LnN0eWxlLm1hcmluZyA9ICcwcHgnXG5cbmltcG9ydCBGRlQgZnJvbSAnLi9GRlQnXG5jb25zdCBmZnQgPSBuZXcgRkZUKClcbmZmdC5sb2FkKCcuL3Jlc291cmNlcy9FenVuKy0rUmV2YWdlcisoT3JpZ2luYWwrTWl4KSstK01hc3Rlci5tcDMnLCAxMjgpXG4gICAgLnRoZW4oKCkgPT4ge1xuXG59KVxuXG5cbmNvbnN0IFdJRFRIID0gd2luZG93LmlubmVyV2lkdGhcbmNvbnN0IEhFSUdIVCA9IHdpbmRvdy5pbm5lckhlaWdodFxuY29uc3QgY2FudmFzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnY2FudmFzJylcbmNhbnZhcy53aWR0aCA9IFdJRFRIXG5jYW52YXMuaGVpZ2h0ID0gSEVJR0hUXG5kb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKGNhbnZhcylcblxuY29uc3QgY29udGV4dCA9IGNhbnZhcy5nZXRDb250ZXh0KCcyZCcpXG5cbmNvbnN0IERJR09OQUxfU0laRSA9IDE2ICAvLyBtdXN0IGJlIG9kZCBudW1iZXJcblxuY29uc3QgdyA9IChXSURUSCA+IEhFSUdIVCkgPyBIRUlHSFQgLyBwYXJzZUludCgoRElHT05BTF9TSVpFICogMS44KSkgOiBXSURUSCAvIHBhcnNlSW50KChESUdPTkFMX1NJWkUgKiAxLjgpKVxuY29uc3QgaCA9IChXSURUSCA+IEhFSUdIVCkgPyBIRUlHSFQgLyBwYXJzZUludCgoRElHT05BTF9TSVpFICogMS44KSkgOiBXSURUSCAvIHBhcnNlSW50KChESUdPTkFMX1NJWkUgKiAxLjgpKVxuY29uc3QgQkxPQ0tfTUFYX0hFSUdIVCA9IGggKiAyXG5jb25zdCBwMSA9IFswLiAqIHcsIC0wLjUgKiBoXVxuY29uc3QgcDIgPSBbMS4gKiB3LCAwLiAqIGhdXG5jb25zdCBwMyA9IFswLiAqIHcsIDAuNSAqIGhdXG5jb25zdCBwNCA9IFstMS4gKiB3LCAwLiAqIGhdXG5cbmNvbnN0IGJsb2NrcyA9IFtdXG5jb25zdCBjb3VudE1hcCA9IHt9XG5mb3IgKGxldCByID0gMDsgciA8PSBESUdPTkFMX1NJWkU7IHIrKykge1xuICBjb25zdCB0ID0gTWF0aC5zaW4ociAvIERJR09OQUxfU0laRSAqIE1hdGguUEkpLnRvRml4ZWQoMilcbiAgbGV0IGNvbENvdW50ID0gY291bnRNYXBbdF1cblxuICBpZiAoIWNvbENvdW50KSB7XG4gICAgY29uc3QgY291bnRBcnIgPSBPYmplY3Qua2V5cyhjb3VudE1hcCkubWFwKChrZXkpID0+IGNvdW50TWFwW2tleV0pXG4gICAgY291bnRNYXBbdF0gPSAoY291bnRBcnIubGVuZ3RoID09IDApID8gMSA6IE1hdGgubWF4LmFwcGx5KG51bGwsIGNvdW50QXJyKSArIDFcbiAgICBjb2xDb3VudCA9IGNvdW50TWFwW3RdXG4gIH1cblxuICBsZXQgc2MgPSB3ICogMC41IC0oY29sQ291bnQgKiB3KVxuICBmb3IgKGxldCBjID0gMDsgYyA8IGNvbENvdW50OyBjKyspIHtcbiAgICBibG9ja3MucHVzaCh7XG4gICAgICB4OiBzYyArIGMgKiB3ICogMiwgeTogciAqIGggKiAwLjVcbiAgICB9KVxuICB9XG59XG5cbmxldCBwcmV2QXZnID0gMFxuY29uc3QgcmVuZGVyID0gKHQpID0+IHtcbiAgY29uc3QgZnJlcXVlbmN5ID0gZmZ0LmdldEZyZXF1ZW5jeSgpXG5cbiAgY29udGV4dC5jbGVhclJlY3QoMCwgMCwgV0lEVEgsIEhFSUdIVClcbiAgY29udGV4dC5maWxsU3R5bGUgPSAnIzAwMCdcbiAgY29udGV4dC5maWxsUmVjdCgwLCAwLCBXSURUSCwgSEVJR0hUKVxuXG4gIGNvbnN0IGNsdXN0ZXJQb3NpdGlvbnMgPSBbXG4gICAge1xuICAgICAgeDogV0lEVEggKiAwLjUgKyB3ICogMC41LCB5OiBIRUlHSFQgKiAwLjUgLSBoICogMy5cbiAgICB9XG4gIF1cblxuICBjbHVzdGVyUG9zaXRpb25zLmZvckVhY2goKGNwLCBqKSA9PiB7XG4gICAgXG4gICAgY29udGV4dC5zYXZlKClcbiAgICBjb250ZXh0LnRyYW5zbGF0ZShjcC54LCBjcC55KVxuICBcbiAgICBsZXQgc3VtID0gMFxuICAgIGJsb2Nrcy5mb3JFYWNoKCh7eCwgeX0sIGkpID0+IHtcbiAgICAgIGNvbnN0IHIgPSAxNDAgKyBwcmV2QXZnICogMjAgLSBpICogMC4zLy9wYXJzZUludChNYXRoLnJhbmRvbSgpICogMjU1KVxuICAgICAgY29uc3QgZyA9IDYwIC0gcHJldkF2ZyAqIDQwIC0gaSAqIDAuMy8vcGFyc2VJbnQoTWF0aC5yYW5kb20oKSAqIDI1NSlcbiAgICAgIGNvbnN0IGIgPSA2MCAtIHByZXZBdmcgKiA0MCAtIGkgKiAwLjMvL3BhcnNlSW50KE1hdGgucmFuZG9tKCkgKiAyNTUpXG5cbiAgICAgIGxldCBmID0gTWF0aC5hYnMoTWF0aC5zaW4oMC44ICogTWF0aC5QSSAqIGkgLyBibG9ja3MubGVuZ3RoICsgdCAqIDAuMDA0KSkgKiAwLjAwMVxuICAgICAgaWYgKGZyZXF1ZW5jeS5sZW5ndGggPiAwKSB7XG4gICAgICAgIGYgKz0gZnJlcXVlbmN5W2kgKyAyMF0gLyAxMjhcbiAgICAgICAgc3VtICs9IGZyZXF1ZW5jeVtpICsgMjBdIC8gMTI4XG4gICAgICB9XG4gICAgICBjb25zdCBoID0gLShCTE9DS19NQVhfSEVJR0hUICogMC4xKSAtIChCTE9DS19NQVhfSEVJR0hUICogMC45ICogTWF0aC5wb3coKGYgKyAwLjUpLCAyKSAqIDAuNSlcblxuICAgICAgY29uc3QgbSA9IDAgLy9wYXJzZUludCgtKDEuIC0gcikgKiAyMClcbiAgXG4gICAgICBjb250ZXh0LmJlZ2luUGF0aCgpXG4gICAgICBjb250ZXh0Lm1vdmVUbyh4ICsgcDFbMF0sIHkgKyBwMVsxXSArIGgpXG4gICAgICBjb250ZXh0LmxpbmVUbyh4ICsgcDJbMF0sIHkgKyBwMlsxXSArIGgpXG4gICAgICBjb250ZXh0LmxpbmVUbyh4ICsgcDNbMF0sIHkgKyBwM1sxXSArIGgpXG4gICAgICBjb250ZXh0LmxpbmVUbyh4ICsgcDRbMF0sIHkgKyBwNFsxXSArIGgpXG4gICAgICBjb250ZXh0LmNsb3NlUGF0aCgpXG4gICAgICBjb250ZXh0LmZpbGxTdHlsZSA9IGByZ2IoJHtyICsgbX0sICR7ZyArIG19LCAke2IgKyBtfSlgXG4gICAgICBjb250ZXh0LmZpbGwoKVxuICBcbiAgICAgIGNvbnRleHQuYmVnaW5QYXRoKClcbiAgICAgIGNvbnRleHQubW92ZVRvKHggKyBwM1swXSwgeSArIHAzWzFdICsgaClcbiAgICAgIGNvbnRleHQubGluZVRvKHggKyBwNFswXSwgeSArIHA0WzFdICsgaClcbiAgICAgIGNvbnRleHQubGluZVRvKHggKyBwNFswXSwgeSArIHA0WzFdKVxuICAgICAgY29udGV4dC5saW5lVG8oeCArIHAzWzBdLCB5ICsgcDNbMV0pXG4gICAgICBjb250ZXh0LmNsb3NlUGF0aCgpXG4gICAgICBjb250ZXh0LmZpbGxTdHlsZSA9IGByZ2IoJHtyIC0gMTAgKyBtfSwgJHtnIC0gMTAgKyBtfSwgJHtiIC0gMTAgKyBtfSlgXG4gICAgICBjb250ZXh0LmZpbGwoKVxuICBcbiAgICAgIGNvbnRleHQuYmVnaW5QYXRoKClcbiAgICAgIGNvbnRleHQubW92ZVRvKHggKyBwMlswXSwgeSArIHAyWzFdICsgaClcbiAgICAgIGNvbnRleHQubGluZVRvKHggKyBwMlswXSwgeSArIHAyWzFdKVxuICAgICAgY29udGV4dC5saW5lVG8oeCArIHAzWzBdLCB5ICsgcDNbMV0pXG4gICAgICBjb250ZXh0LmxpbmVUbyh4ICsgcDNbMF0sIHkgKyBwM1sxXSArIGgpXG4gICAgICBjb250ZXh0LmNsb3NlUGF0aCgpXG4gICAgICBjb250ZXh0LmZpbGxTdHlsZSA9IGByZ2IoJHtyICsgMTAgKyBtfSwgJHtnICsgMTAgKyBtfSwgJHtiICsgMTAgKyBtfSlgXG4gICAgICBjb250ZXh0LmZpbGwoKVxuICAgIH0pXG4gICAgcHJldkF2ZyA9IHN1bSAvIGJsb2Nrcy5sZW5ndGhcbiAgICBjb250ZXh0LnJlc3RvcmUoKVxuICB9KVxuXG4gIHJlcXVlc3RBbmltYXRpb25GcmFtZShyZW5kZXIpICBcbn1cblxucmVxdWVzdEFuaW1hdGlvbkZyYW1lKHJlbmRlcilcbiJdfQ==
